<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Article 35666079690131</title>
</head>
<body>
    <pre>{
  "id": 35666079690131,
  "url": "https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/experimental/articles/35666079690131.json",
  "html_url": "https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/experimental/articles/35666079690131.html",
  "author_id": 31899104510995,
  "comments_disabled": true,
  "draft": false,
  "promoted": false,
  "position": 0,
  "vote_sum": 1,
  "vote_count": 1,
  "section_id": 35656836602259,
  "created_at": "2024-11-21T23:16:48Z",
  "updated_at": "2025-08-08T09:29:02Z",
  "name": "Defend - Microsoft Exchange Online Protection and Microsoft Defender",
  "title": "Defend - Microsoft Exchange Online Protection and Microsoft Defender",
  "source_locale": "en-us",
  "locale": "en-us",
  "outdated": false,
  "outdated_locales": [],
  "edited_at": "2025-04-15T10:26:27Z",
  "user_segment_id": null,
  "permission_group_id": 195648,
  "content_tag_ids": [],
  "label_names": [
    "answerbot_defend"
  ],
  "body": "<p>Understanding the interactions between Microsoft Exchange Online Protection (EOP), Microsoft Defender, and Defend is crucial for optimizing your organization's email security. To effectively understand how these systems interact, this article will walk you through the email filtering process.</p>\n<p>When an email is received by an organization using EOP, Defender, and Defend, the filtering process follows a specific sequence:</p>\n<ol>\n<li>\n<strong>Initial filtering by EOP and Microsoft Defender:</strong>\n<ol type='alpha'>\n<li>The first layer of defense involves filtering by EOP and Microsoft Defender. This step includes various security checks, such as spam filtering, malware scanning, and the application of any configured Microsoft 365 transport rules.</li>\n<li>It's important to note that even if an email triggers a transport rule designed to route the email through a specific connector. Instead, the remaining EOP or Microsoft Defender processing steps continue. A header to the email noting which connector should be used once further processing steps have been followed.</li>\n</ol>\n</li>\n<li>\n<strong>Interaction with Defend:</strong>\n<ol type='alpha'>\n<li>Once the email has passed through all EOP or Microsoft Defender processing and has not been quarantined, it is routed to Defend. At this stage, Defend performs its analysis, including advanced threat protection and data loss prevention checks.</li>\n</ol>\n</li>\n</ol>\n<p>For organizations that have enabled Microsoft Defender, particularly the Safe Attachments feature, there is a specific interaction to be aware of:</p>\n<ul>\n<li>During the initial pass through Microsoft Exchange, a transport rule called \"Defend disabled ATP dynamic scanning\" temporarily disables the dynamic scanning log for attachments.</li>\n<li>This action is necessary because the Safe Attachments feature may remove the attachment and place it in a sandbox for analysis, preventing Defend features from seeing the complete email.</li>\n<li>If Defend cannot analyze the full content, its detection capabilities are compromised.</li>\n<li>After the Defend console has completed its analysis and the email returns to Microsoft 365, dynamic scanning for the Safe attachments feature is still executed, for a second time, along with all other EOP or Microsoft Defender processing.</li>\n</ul>\n<p><a data-fancybox='single' data-src='https://helpimg.s3.amazonaws.com/egress/0EMSr0000052gDB.jpg'> <img src='https://helpimg.s3.amazonaws.com/egress/0EMSr0000052gDB.jpg' alt=''> </a></p>\n<h2 id='h_01JEXNMRXQB273KQ6JFQZJH7YP'>Microsoft Exchange Online Protection (EOP) and Microsoft Defender Online (MDO) with Defend\u00a0</h2>\n<p>All EOP or Microsoft Defender filtering happens before an email is routed to Defend.</p>\n<p>Transport rules are executed at the policy enforcement step. If the email triggers a transport rule that has an action to route out via a connector, Microsoft Exchange adds a header or property to the email to remember which connector should be used. It will then continue with processing the other steps. It does not send the email to Defend at this point.</p>\n<p>Once an email has gone through all EOP or Microsoft Defender processing, if it has not been quarantined, it will be routed to Defend.</p>\n<p>If you have Microsoft Defender enabled, specifically Safe Attachments functionality, there is a transport rule called \"Defend Disable ATP Dynamic Scanning\" that disables the dynamic attachment logic for all inbound emails on the first pass through Microsoft Exchange processing. This action is because the attachment can be removed and placed in a sandbox, which could result in Defend not seeing the complete email, which would hamper the detection.</p>\n<p>When the message returns to Microsoft 365 from Defend, the dynamic scanning for safe attachments is still executed, along with all other EOP or Microsoft Defender processing for a second time.</p>",
  "user_segment_ids": [],
  "source_url": "https://support.knowbe4.com/hc/en-us/articles/35666079690131-Defend-Microsoft-Exchange-Online-Protection-and-Microsoft-Defender",
  "images": [
    {
      "url": "https://helpimg.s3.amazonaws.com/egress/0EMSr0000052gDB.jpg",
      "alt": "This image is a technical flowchart illustrating the email security processing pipeline, involving Microsoft security products.\n\n**Overall Structure:**\nThe flow begins with an envelope icon, proceeds horizontally through multiple filtering stages, and concludes with either **Quarantine, Quarantine Policy** or **Mailbox**. A key entry point, **\"Defend,\"** connects via an arrow to the initial stage.\n\n**Processing Stages (Left to Right):**\nThe pipeline is segmented into functional modules, each categorized under one of three products: Exchange Online Protection (EOP) or Microsoft Defender for M365 (Microsoft Defender for M365).\n\n1.  **Exchange Online Protection (EOP) - Initial Block:**\n    *   **Edge Blocking:** Contains sub-steps: IP based connection filtering (Red dashed box), URL block list (Red dashed box), and Directory Based Edge Blocking (DBEB) (Red dashed box).\n    *   **Virus & Malware Scanning:** Contains sub-steps: AV Engine 1 (Red dashed box), AV Engine 2 (Red dashed box), AV Engine 3 (Red dashed box), and Attachment filtering (Red dashed box).\n    *   **Policy Enforcement:** Contains the sub-step Transport rules (Red dashed box).\n\n2.  **Microsoft Defender for M365 - Advanced Protection:**\n    *   **Safe Attachments, Safe Links:** Contains sub-steps: Reputation (Teal dashed box), Safe links rules (Teal dashed box), and Sandbox (Teal dashed box).\n    *   **Anti-Phishing:** Contains sub-steps: Machine learning (Teal dashed box), Mailbox and spoof intelligence (Teal dashed box), and Custom phishing rules (Teal dashed box).\n\n3.  **Exchange Online Protection (EOP) - Secondary Filtering:**\n    *   **Spam Filtering:** Contains sub-steps: Safe list (Red dashed box), Bulk mail filtering (Red dashed box), Content filtering (Red dashed box), and Advanced spam filtering (Red dashed box).\n\n4.  **Exchange Online Protection (EOP) - Delivery:**\n    *   **Email Delivery:** Contains the sub-step Deliver email (Red dashed box). This stage leads to the final **Mailbox** destination.\n\n5.  **Microsoft Defender for M365 - Post-Delivery Processing:**\n    *   **ZAP Processing:** Contains the sub-step Continuous zero-hour processing (Teal dashed box). This stage leads to the final **Mailbox** destination.\n\n**Flow and Outcomes:**\n*   Arrows indicate sequential processing between stages.\n*   A major outflow path splits from the first seven processing stages, directing failed messages to the **Quarantine, Quarantine Policy** box (light blue background).\n*   The final two delivery stages (**Email Delivery** and **ZAP Processing**) converge and lead to the **Mailbox** box (light blue background).\n*   The red/pink color-coded boxes (e.g., EOP, red dashed boxes) represent standard or foundational protection elements, while the light blue boxes (e.g., Microsoft Defender for M365, teal dashed boxes) represent advanced protection features.",
      "position": 1,
      "context": "executed, for a second time, along with all other EOP or Microsoft Defender processing."
    }
  ],
  "metadata": {
    "category": "",
    "section": "",
    "topics": [
      "and",
      "defend",
      "defender",
      "exchange",
      "microsoft",
      "online",
      "protection"
    ],
    "image_count": 1
  }
}</pre>
</body>
</html>