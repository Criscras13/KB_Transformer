{
  "article": {
    "id": 115004326408,
    "url": "https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/experimental/articles/115004326408.json",
    "html_url": "https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/experimental/articles/115004326408.html",
    "author_id": 1450288687,
    "comments_disabled": true,
    "draft": false,
    "promoted": false,
    "position": 10,
    "vote_sum": 14,
    "vote_count": 16,
    "section_id": 26244236265875,
    "created_at": "2017-03-09T21:39:51Z",
    "updated_at": "2025-03-11T16:55:07Z",
    "name": "Bypass Safe Link and Safe Attachments in Microsoft Defender for Office 365",
    "title": "Bypass Safe Link and Safe Attachments in Microsoft Defender for Office 365",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2025-03-11T16:55:07Z",
    "user_segment_id": null,
    "permission_group_id": 195648,
    "content_tag_ids": [],
    "label_names": [
      "whitelisting",
      "atp",
      "advanced threat protection",
      "reviewed_OH_10_19",
      "answerbot",
      "answerbot_kmsat"
    ],
    "body": "<div class='callout-remember'>\n<div class='callout__content'>\n<strong>Note:</strong>If you use Microsoft 365, Microsoft requires that you use advanced delivery policies to ensure email delivery. If advanced delivery policies are in use in your environment, adding these rules will interfere with KnowBe4's phishing security tests (PSTs) being identified as a third-party phishing simulations. For more information, see our <a href='https://support.knowbe4.com/hc/en-us/articles/4404511190803'>Advanced Delivery Policies in Microsoft Defender for Office 365</a> article.</div>\n</div>\n<p>If you are using Microsoft Defender for Office in your mail environment and have experienced false clicks or false attachment opens, it is because Defender for Office has link processing and attachment processing rules that are causing this. You can set up additional mail flow rules that allow you to bypass safe links and attachments processing for phishing test emails from KnowBe4's IP addresses. However, if you have a mail filter in front of your mail server, we recommend you whitelist in Microsoft Defender for Office by email header instead.</p>\n<p>You only need to create rules for your organization's needs. For example, if you whitelist by header, follow the Safe Link Bypass Rule by Header and Safe Attachments Bypass Rule by Header sections. We recommend that you allow an hour for the rules to circulate to all of your users. To test out your rule, set up a phishing campaign for a small test group that includes yourself prior to starting a phishing campaign.\u00a0</p>\n<div class='callout callout-remember'>\n<div class='callout__content'>\n<strong>Note:</strong>Whitelisting the URL overwrite in safe links isn't supported for phishing simulations. For more information, see Microsoft's <a href='https://learn.microsoft.com/en-us/defender-office-365/safe-links-policies-configure' target='_blank' rel='noopener noreferrer'>safe links policies article</a>.</div>\n</div>\n<h2 id='h_01HASPJANZV8H5F7SY3RV6TAEF'>Safe Link Bypass Rule</h2>\n<p>To set up a mail flow rule to bypass <strong>Safe</strong><strong>\u00a0link processing:</strong></p>\n<ol role='list'>\n<li>Create a new mail flow rule in your <a href='https://learn.microsoft.com/en-us/office365/servicedescriptions/office-365-advanced-threat-protection-service-description' target='_self'>Microsoft 365 Exchange admin center</a>.</li>\n<li>Give the rule a name such as \"Bypass Safe Links\".</li>\n<li>Click <strong>More options...</strong>.</li>\n<li>From the <strong>Apply this rule if\u2026.</strong> drop-down menu, select<strong> The senders</strong>\u00a0then select <strong>IP address is in any of these ranges or exactly matches.\u00a0</strong>\n</li>\n<li>Enter our IP address. For the most up-to-date list of our IP addresses, please see <a href='https://support.knowbe4.com/hc/en-us/articles/203645138-Whitelisting-Data-and-Anti-Spam-Filtering-Information#whitelist' target='_self'>this article</a>.</li>\n<li>From the <strong>Do the following\u2026 </strong>drop-down menu, select <strong>Modify the message properties...\u00a0</strong>and then <strong>set a message header</strong>.</li>\n<li>Click the first <strong>*Enter text...</strong> link and set the message header to \"X-MS-Exchange-Organization-SkipSafeLinksProcessing\".</li>\n<li>Click the second\u00a0<strong>*Enter text...</strong> link and set the value to \"1\".</li>\n<li>Click <strong>Save</strong>. <a data-fancybox='single' data-src='https://s3.amazonaws.com/helpimg/ATPRules/ATP%20RULES/ATP-Link%20Rule.png'><img src='https://s3.amazonaws.com/helpimg/ATPRules/ATP%20RULES/ATP-Link%20Rule.png' alt=' '></a>\n</li>\n</ol>\n<h2 id='h_01HASPJANZ4FXWPZS03HMK8PQ7'>Safe Attachments Bypass Rule</h2>\n<p>Below are the steps to set up a mail flow rule to bypass <strong>Safe</strong><strong> Attachments Processing</strong>:</p>\n<ol role='list'>\n<li>Create a new mail flow rule in your <a href='https://learn.microsoft.com/en-us/office365/servicedescriptions/office-365-advanced-threat-protection-service-description' target='_self'>Microsoft 365 Exchange admin center</a>.</li>\n<li>Give the rule a name such as Bypass Safe Attachments.</li>\n<li>Click<strong> more options</strong>.</li>\n<li>From the <strong>Apply this rule if\u2026\u00a0</strong>drop-down, select<strong> The senders</strong>\u00a0then select <strong>IP address is in any of these ranges or exactly matches.\u00a0</strong>\n</li>\n<li>Enter our IP addresses. Please see <a href='https://support.knowbe4.com/hc/en-us/articles/203645138-Whitelisting-Data-and-Anti-Spam-Filtering-Information#whitelist' target='_self'>this article</a> for the most up-to-date list of our IP addresses.</li>\n<li>From the <strong>Do the following\u2026</strong> drop-down,\u00a0select <strong>Modify the message properties...\u00a0</strong>and then <strong>set a message header</strong>.</li>\n<li>Click the first <strong>*Enter text...</strong> link and set the message header to \"X-MS-Exchange-Organization-SkipSafeAttachmentProcessing\".\u00a0</li>\n<li>Click the second\u00a0<strong>*Enter text...</strong> link and set the value to \"1\".\u00a0</li>\n<li>Click <strong>Save.</strong>\u00a0 <a data-fancybox='single' data-src='https://s3.amazonaws.com/helpimg/ATPRules/ATP%20RULES/ATP%20-Attachment%20Rule.png'><img src='https://s3.amazonaws.com/helpimg/ATPRules/ATP%20RULES/ATP%20-Attachment%20Rule.png' alt=' '></a>\n</li>\n</ol>\n<h2 id='h_01HASPJANZBANN578PYY15DB1Z'>Safe Link Bypass Rule by Header</h2>\n<p>To set up a mail flow rule to bypass Safe Link processing by header:</p>\n<ol role='list'>\n<li>Create a new mail flow rule in your <a href='https://learn.microsoft.com/en-us/office365/servicedescriptions/office-365-advanced-threat-protection-service-description' target='_blank' rel='noopener noreferrer'>Microsoft 365 Exchange admin center</a>.</li>\n<li>Give the rule a name such as \"Bypass Safe Links\".</li>\n<li>Click\u00a0<strong>More options...</strong>.</li>\n<li>From the\u00a0<strong>Apply this rule if\u2026</strong>\u00a0drop-down menu,\u00a0 select\u00a0<strong>A message header...\u00a0</strong>then selects <strong>includes any of these words</strong>.</li>\n<li>On the right side of that rule, you will see <strong>*Enter text...</strong>\u00a0and <strong>*Enter words...</strong>\n</li>\n<li>Click\u00a0<strong>*Enter text... </strong>to open the<strong> specify header name</strong>\u00a0window. In this window, type the header name.\u00a0For more information on what to enter for your header name, see the note below.\n<div class='callout-note'>\n<div class='callout__content'>\n<strong>Note:</strong>By default, the header for KnowBe4 mail is X-PHISHTEST. We recommend that you change the default header to a custom header or header token for enhanced security. You can change the header settings for your account from the <strong>Account Setting</strong>s page. For more information, see our\u00a0<a href='https://support.knowbe4.com/hc/en-us/articles/226457887-How-to-Edit-Your-Account-Settings#PHISHHEADERS' target='_self'>How to Edit Your Account Settings</a>\u00a0article.</div>\n</div>\n</li>\n<li>Click <strong>*Enter words \u2026\u00a0</strong>and type in <strong>KnowBe4</strong> and click the\u00a0<strong>+</strong> sign.</li>\n<li>From the <strong>Do the following\u2026 </strong>drop-down menu, select <strong>Modify the message properties...\u00a0</strong>and then <strong>set a message header</strong>.</li>\n<li>Click the first <strong>*Enter text...</strong> link and set the message header to \"X-MS-Exchange-Organization-SkipSafeLinksProcessing\".\u00a0</li>\n<li>Click the second <strong>*Enter text...</strong> link and set the value to \"1\".\u00a0</li>\n<li>Click\u00a0<strong>Save</strong>. <a data-fancybox='single' data-src='https://helpimg.s3.amazonaws.com/ATPRules/ATP+RULES/ATPLinkBypassRulebyHeader.png'><img src='https://helpimg.s3.amazonaws.com/ATPRules/ATP+RULES/ATPLinkBypassRulebyHeader.png' alt=' '></a>\n</li>\n</ol>\n<h2 id='h_01HASPJANZ4Z2WM9RV755T17YG'>Safe Attachments Bypass Rule by Header</h2>\n<p>Below are the steps to set up a mail flow rule to bypass <strong>Safe</strong><strong> Attachments Processing </strong>by header:</p>\n<ol role='list'>\n<li>Create a new mail flow rule in your <a href='https://learn.microsoft.com/en-us/office365/servicedescriptions/office-365-advanced-threat-protection-service-description' target='_self'>Microsoft 365 Exchange admin center</a>.</li>\n<li>Give the rule a name such as \"Bypass Safe Attachments by Header\".</li>\n<li>Click<strong> more options</strong>.</li>\n<li>From the\u00a0<strong>Apply this rule if\u2026</strong>\u00a0drop-down menu,\u00a0 select\u00a0<strong>A message header...\u00a0</strong>then selects <strong>includes any of these words</strong>.</li>\n<li>On the right side of that rule, you will see <strong>*Enter text...</strong>\u00a0and <strong>*Enter words...</strong>\n</li>\n<li>Click\u00a0<strong>*Enter text... </strong>to open the<strong> specify header name</strong>\u00a0window. In this window, type the header name.\u00a0For more information on what to enter for your header name, see the note below.\n<div class='callout-note'>\n<div class='callout__content'>\n<strong>Note:</strong>By default, the header for KnowBe4 mail is X-PHISHTEST. We recommend that you change the default header to a custom header or header token for enhanced security. You can change the header settings for your account from the <strong>Account Setting</strong>s page. For more information, see our\u00a0<a href='https://support.knowbe4.com/hc/en-us/articles/226457887-How-to-Edit-Your-Account-Settings#PHISHHEADERS' target='_self'>How to Edit Your Account Settings</a>\u00a0article.</div>\n</div>\n</li>\n<li>Click <strong>*Enter words \u2026\u00a0</strong>and type in keyword that should be found in the header. By default, the keyword would be \"KnowBe4\". Click the <strong>+</strong> sign.</li>\n<li>From the <strong>Do the following\u2026</strong> drop-down,\u00a0select <strong>Modify the message properties...\u00a0</strong>and then <strong>set a message header</strong>.</li>\n<li>Click the first <strong>*Enter text...</strong> link and set the message header to \"X-MS-Exchange-Organization-SkipSafeAttachmentProcessing\".\u00a0</li>\n<li>Click the second\u00a0<strong>*Enter text...</strong> link and set the value to \"1\".\u00a0</li>\n<li>Click <strong>Save.</strong>\u00a0 <a data-fancybox='single' data-src='https://helpimg.s3.amazonaws.com/ATPRules/ATP+RULES/ATP-AttachmentRule.png'><img src='https://helpimg.s3.amazonaws.com/ATPRules/ATP+RULES/ATP-AttachmentRule.png' alt=' '></a>\n</li>\n</ol>\n<p>Still need assistance? <a href='https://support.knowbe4.com/hc/en-us/requests/new' target='_blank' rel='noopener noreferrer'>Submit a support ticket</a> and we can help!</p>",
    "user_segment_ids": [],
    "source_url": "https://support.knowbe4.com/hc/en-us/articles/115004326408-Bypass-Safe-Link-and-Safe-Attachments-in-Microsoft-Defender-for-Office-365",
    "images": [
      {
        "url": "https://s3.amazonaws.com/helpimg/ATPRules/ATP%20RULES/ATP-Link%20Rule.png",
        "alt": "This image displays a configuration screen for creating a mail flow rule, likely within a Microsoft Exchange or Microsoft 365 administrative interface, focused on security bypass.\n\n**Title and Rule Name:**\nThe page title is \"Bypass ATP Links.\"\nA text field labeled \"Name:\" contains the input value: \"**Bypass ATP Links**\" (highlighted by a light blue border).\n\n**Condition (Apply this rule if...):**\nThe section \"*Apply this rule if...\" defines the conditions.\nThe currently selected condition is: \"**Sender's IP address is in the range...**\" (within a dropdown menu).\nA second input field, containing a blurred/redacted value, is adjacent to the condition dropdown, presumably specifying the IP range.\nA button labeled \"**add condition**\" is present below the current condition line.\n\n**Action (Do the following...):**\nThe section \"*Do the following...\" defines the actions taken if the condition is met.\nThe first part of the action is set via a dropdown: \"**Set the message header to this value...**\"\nThe full, configured action is displayed to the right: \"**Set the message header 'X-MS-Exchange-Organization-SkipSafeLinksProcessing' to the value '1'**\". (Note: The header name is displayed as a dark blue, underlined hyperlink).\nA button labeled \"**add action**\" is present below the action line.\n\n**Exception (Except if...):**\nThe section \"Except if...\" allows defining exceptions to the rule.\nA button labeled \"**add exception**\" is present.\n\n**Additional Context:**\nThe bottom of the screen shows the label: \"**Properties of this rule:**\".\nThe overall interface utilizes a clean, white background with dark grey text and standard dropdown/button UI elements. The configuration appears to create a transport rule designed to bypass Advanced Threat Protection (ATP) Safe Links processing for messages originating from specific IP addresses.",
        "position": 1,
        "context": "link and set the value to \"1\".\nClick Save."
      },
      {
        "url": "https://s3.amazonaws.com/helpimg/ATPRules/ATP%20RULES/ATP%20-Attachment%20Rule.png",
        "alt": "This image displays a configuration screen for a mail flow rule, titled \"Bypass ATP - Attachments,\" designed to exempt specific messages from Advanced Threat Protection (ATP) Safe Attachments processing.\n\n**Rule Configuration Details:**\n\n1.  **Name:** The rule is named \"Bypass ATP - Attachments.\"\n2.  **Condition (`*Apply this rule if...`):**\n    *   The rule is configured to match messages based on the sender's origin IP address: \"Sender's IP address is in the range...\" (The specific IP range value is blurred).\n    *   An \"add condition\" button is available.\n3.  **Action (`*Do the following...`):**\n    *   **Primary Action:** \"Set the message header to this value...\"\n    *   **Technical Detail:** This action explicitly sets the message header `X-MS-Exchange-Organization-SkipSafeAttachmentProcessing` to the value `'1'`. This header manipulation instructs the system to bypass attachment scanning.\n    *   **Secondary Action:** An additional, undefined action placeholder labeled \"and Select one\" is present.\n    *   An \"add action\" button is available.\n4.  **Exceptions:**\n    *   An \"Except if...\" section with an \"add exception\" button is available for defining exclusionary criteria.\n5.  **Properties:** The UI indicates further administrative settings are present below the visible area (\"Properties of this rule:\").",
        "position": 2,
        "context": "/strong> link and set the value to \"1\".\u00a0\nClick Save."
      },
      {
        "url": "https://helpimg.s3.amazonaws.com/ATPRules/ATP+RULES/ATPLinkBypassRulebyHeader.png",
        "alt": "This image displays a configuration screen titled \"**new rule**,\" designed for setting up a mail flow or transport rule, likely within an Exchange or Office 365 environment.\n\n**Rule Configuration Details:**\n\n1.  **Name:** Input field containing the text: \"**Bypass ATP Links**.\"\n2.  **\\*Apply this rule if...** (Condition):\n    *   Dropdown menu selected value: \"**A message header includes...**\"\n    *   Configuration details displayed to the right: \"**'HeaderName' header includes 'HeaderValue'**\" (HeaderName and HeaderValue are underlined, indicating they are hyperlinked placeholders for configuration).\n    *   Action button: \"**add condition**.\"\n3.  **\\*Do the following...** (Action):\n    *   Dropdown menu selected value: \"**Set the message header to this value...**\"\n    *   Configuration details displayed to the right: \"**Set the message header 'X-MS-Exchange-Organization-SkipSafeLinksProcessing' to the value '1'**.\" (The header name and value '1' are underlined, indicating they are configured values).\n    *   Action button: \"**add action**.\"\n4.  **Except if...** (Exception):\n    *   Action button: \"**add exception**.\"\n5.  **Properties of this rule:**\n    *   Checkbox (checked): \"**Audit this rule with severity level:**\"\n    *   Dropdown menu: \"**Not specified**\" (selected value).\n\n**Footer Controls:**\n\nThe bottom right features two primary action buttons:\n\n*   **Save**\n*   **Cancel**",
        "position": 3,
        "context": "link and set the value to \"1\".\u00a0\nClick\u00a0Save."
      },
      {
        "url": "https://helpimg.s3.amazonaws.com/ATPRules/ATP+RULES/ATP-AttachmentRule.png",
        "alt": "The image displays a configuration screen for creating a transport rule, titled \"new rule.\" The interface is organized into conditional logic sections.\n\n**Rule Identification:**\n*   **Name:** The input field contains the text \"Bypass ATP by Header- Attachments.\"\n\n**Rule Conditions (Apply this rule if...):**\n*   **Condition Selection:** A dropdown menu is selected to \"A message header includes...\"\n*   **Condition Details:** The resulting rule definition is displayed on the right: \"'HeaderName' header includes 'Keyword'.\"\n*   **Control:** An \"add condition\" button is present below the selection area.\n\n**Rule Actions (Do the following...):**\n*   **Action Selection:** A dropdown menu is selected to \"Set the message header to this value...\"\n*   **Action Details:** The configuration is set to: \"Set the message header 'X-MS-Exchange-Organization-SkipSafeAttachmentProcessing' to the value '1'.\" (This action is used to bypass Safe Attachment Processing/ATP).\n*   **Control:** An \"add action\" button is present below the selection area.\n\n**Rule Exceptions (Except if...):**\n*   **Control:** An \"add exception\" button is available for defining exceptions.\n\n**Footer:**\n*   The final visible element is the section header: \"Properties of this rule:\".",
        "position": 4,
        "context": "link and set the value to \"1\".\u00a0\nClick Save."
      }
    ],
    "metadata": {
      "category": "Security Awareness Training",
      "section": "Microsoft",
      "topics": [
        "and",
        "attachments",
        "awareness",
        "bypass",
        "defender",
        "for",
        "microsoft",
        "office",
        "safe",
        "security",
        "training"
      ],
      "image_count": 4
    }
  }
}