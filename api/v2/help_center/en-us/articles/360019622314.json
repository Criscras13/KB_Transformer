{
  "article": {
    "id": 360019622314,
    "url": "https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/360019622314.json",
    "html_url": "https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/360019622314.html",
    "author_id": 360322304667,
    "comments_disabled": true,
    "draft": false,
    "promoted": false,
    "position": 2,
    "vote_sum": 5,
    "vote_count": 7,
    "section_id": 20416693775123,
    "created_at": "2019-03-14T14:16:20Z",
    "updated_at": "2025-05-13T17:50:18Z",
    "name": "Use Cases for YARA Rules",
    "title": "Use Cases for YARA Rules",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2025-03-11T17:19:25Z",
    "user_segment_id": null,
    "permission_group_id": 195648,
    "content_tag_ids": [],
    "label_names": [
      "PhishER",
      "localized",
      "answerbot",
      "answerbot_phisher"
    ],
    "body": "<p>All <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/360013025854.html' target='_self'>PhishER rules</a> must follow Yet Another Recursive or Ridiculous Acronym (YARA) rule logic to disposition messages. You can use YARA rules to disposition messages based on included attachments, potential CEO fraud, and more. This guide provides a list of common use cases for YARA rules. You can create these rules to use in your PhishER platform. For general information about writing YARA rules, see our <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/360013116053.html' target='_blank' rel='noopener'>How to Write YARA Rules</a> article or <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/360015134714.html' target='_blank' rel='noopener'>YARA Rules</a> video.</p>\n<h2 id='h_01HSBP4VQTFK1TZ0WHJ1N8Y2Y7'>Attachments Rule</h2>\n<p>If you would like to create a YARA rule that detects if any type of attachment is included in an email, you can use the example rule in the screenshot and code block below:</p>\n<div><a data-fancybox='single' data-src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/attachments.png'> <img src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/attachments.png'></a></div>\n<pre>rule Attachments<br>\n{<br>\n  strings:<br>\n    $Attachment = \"X-Attachment-Id\"<br>\n\n  condition:<br>\n    $Attachment<br>\n}\n</pre>\n<p>This rule does not detect specific attachment types. If you would like to write a rule that detects specific attachment types, you can use the example rules in the screenshot and code block below:</p>\n<div><a data-fancybox='single' data-src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/attachmentTypes.png'> <img src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/attachmentTypes.png'></a></div>\n<div class='callout-tip'>\n<div class='callout__content'>\n<strong>Tip:</strong>Depending on what information you want to detect, you can customize this rule by adding or removing different attachment types.</div>\n</div>\n<pre>rule Attachments {\n  strings:\n    $doc = \".doc\"\n    $htm = \".htm\"\n    $exe = \".exe\"\n    $pdf = \".pdf\"\n    $excel = \".xlsx\"\n    $ics = \".ics\"\n    $png = \".png\"\n    $jpg = \".jpg\"\n    $gif = \".gif\"\n  condition:\n    any of them\n}\n</pre>\n<h2 id='h_01HSBP4VQT3D02TSN0XXQMF9FR'>Automated Software Emails Rule</h2>\n<p>If you would like to create a YARA rule that detects automated software emails, you can use the example rule in the screenshot and code block below:</p>\n<div class='callout-remember'>\n<div class='callout__content'>\n<strong>Important:</strong>This rule can flag legitimate emails because it looks for the text in brackets in the from email address or the subject line of an email.</div>\n</div>\n<div><a data-fancybox='single' data-src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/automatedSoftwareEmails.png'> <img src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/automatedSoftwareEmails.png'></a></div>\n<pre>rule Automated_SoftwareEmails\n{\n  strings:\n    $ = /(\\n|\\r)From:.{0,200}<strong>[Salesforce]</strong>.{0,200}&lt;/ nocase\n    $ = /(\\n|\\r)Subject:.{0,200}<strong>[Salesforce]</strong>/ nocase\n\n    $ = /(\\n|\\r)From:.{0,200}<strong>[HubSpot]</strong>.{0,200}&lt;/ nocase\n    $ = /(\\n|\\r)Subject:.{0,200}<strong>[HubSpot]</strong>/ nocase\n\n  condition:\n    any of them\n}</pre>\n<p>For this rule to work, you'll need to replace the text in brackets with the name of a software application. We recommend that you use the name of a software application that your organization uses or would likely receive an email from.</p>\n<h2 id='h_01HSBP4VQT3Y6KHHYGQCC5FS5N'>CEO Fraud Rule</h2>\n<p>If you would like to create a YARA rule that identifies potential CEO fraud attempts, you can use the example rule in the screenshot and code block below:</p>\n<div><a data-fancybox='single' data-src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/ceoFraud.png'><img src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/ceoFraud.png'></a></div>\n<pre>rule CEO_Fraud\n{\n  strings:\n    $FromEmail        = /From:.{0,20}\\&lt;<strong>[yourCEO@example.com]</strong>\\&gt;/ nocase\n    $FromName\t        = /From:.{0,20}<strong>[yourCEO]</strong>.{0,20}&lt;.{5,100}&gt;/ nocase\n    $FromNameEmail    = /From:.{0,20}<strong>[yourCEO]</strong>.{0,20}\\&lt;<strong>[yourCEO@example.com]</strong>\\&gt;/ nocase\n\n    $Reply            = /Reply-To:.{0,20}/ nocase\n    $ReplyEmail       = /Reply-To:.{0,20}\\&lt;<strong>[yourCEO@example.com]</strong>\\&gt;/ nocase\n    $ReplyName\t      = /Reply-To:.{0,20}<strong>[yourCEO]</strong>.{0,20}\\&lt;/ nocase\n    $ReplyNameEmail   = /Reply-To:.{0,20}<strong>[yourCEO]</strong>.{0,20}\\&lt;<strong>[yourCEO@example.com]</strong>\\&gt;/ nocase\n\n  condition:\n    ($Reply and $FromNameEmail and not $ReplyNameEmail)\n    or ($Reply and not $FromNameEmail and $ReplyNameEmail)\n    or ($Reply and $FromEmail and not $ReplyEmail)\n    or ($Reply and not $FromEmail and $ReplyEmail)\n    or ($FromName and not $FromEmail)\n    or ($ReplyName and not $ReplyNameEmail)\n}</pre>\n<p>If you use this rule, you'll need to replace each instance of the <strong>[yourCEO@example.com]</strong> placeholder with your CEO's email address. You'll also need to replace each instance of the <strong>[yourCEO] </strong>placeholder with your CEO's name.</p>\n<h2 id='h_01HSBP4VQTBYRT41FPK1YNRQ79'>Internal Sender Rule</h2>\n<p>If you would like to create a YARA rule that identifies any email coming from your domain that is not a spoofed email, you can use the example rule in the screenshot and code block below:</p>\n<div><a data-fancybox='single' data-src='https://helpimg.s3.amazonaws.com/PhishER/YARA-UseCase/InternalSenderRule.png'> <img src='https://helpimg.s3.amazonaws.com/PhishER/YARA-UseCase/InternalSenderRule.png'></a></div>\n<pre>rule InternalSender\n{\n  strings:\n\t$a = /from:.{0,60}@domain.com/ nocase\n\t$b = /Return-Path:.{0,60}@domain.com/ nocase\n\t$c = \"header.from=domain.com\"\n\t$d = /Authentication-Results:.{0,20}spf=pass/ nocase\n\t\n  condition:\n    all of them\n}</pre>\n<div class='callout-tip'>\n<div class='callout__content'>\n<strong>Tip:</strong>If you use this rule, the email will need a matching sender domain in the headers and will need to pass your Sender Policy Framework (SPF) checks. This rule will not tag emails sent from your domain that do not require or pass your SPF checks. If you would like to tag the types of emails mentioned, remove the <strong>$d</strong> string. You can also remove the <strong>$c</strong> string.</div>\n</div>\n<h2 id='h_01HSBP4VQTG7ZQBMJF11VBN09D'>KnowBe4 Training Emails Rule</h2>\n<p>If you would like to create a YARA rule that detects all training notification emails from your KSAT console, you can use the example rule in the screenshot and code block below:</p>\n<div><a data-fancybox='single' data-src='https://helpimg.s3.amazonaws.com/PhishER/YARA-UseCase/trainingEmails.png'> <img src='https://helpimg.s3.amazonaws.com/PhishER/YARA-UseCase/trainingEmails.png'></a></div>\n<pre>rule KnowBe4_TrainingEmails\n{\n  strings:\n  $ = /Return-Path:.{0,50}psm.knowbe4.com&gt;/ nocase\n  $ = /Received:.{0,50}(147.160.167.\\d{1,3})/ nocase\n  $ = /Received:.{0,50}(23.21.109.197)/ nocase\n  $ = /Received:.{0,50}(23.21.109.212)/ nocase\n  $ = /Received:.{0,50}psm.knowbe4.com/ nocase\n\n  condition:\n    any of them\n}</pre>\n<h2 id='h_01HSBP4VQT878EVXR4NMPV7A3T'>Not Present Rule</h2>\n<p>You can create a YARA rule that detects if a value is not present in a selected PhishER target. To create this rule, you can use the example rule in the screenshot and code block below:</p>\n<div><a data-fancybox='single' data-src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/notPresent.png'><img src='https://s3.amazonaws.com/helpimg/PhishER/YARA-UseCase/notPresent.png' alt=' '></a></div>\n<pre>rule notPresent\n{\n  strings:\n    $a = \"KnowBe4\" nocase\n\n  condition:\n    (not $a) and (filesize &gt; 0)\n}</pre>\n<p>To use this rule, you'll need to include the special variable <strong>filesize</strong> in your rule's condition. The <strong>filesize</strong> variable checks if the target you selected is empty. This process is helpful if you receive an email with a plain text body and an HTML body since one type of body could be empty but the other body could contain your string. Without the <strong>filesize</strong> variable, the email could falsely match your notPresent rule.</p>\n<h2 id='h_01HSBP4VQTP0BMZM010PBYP0MT'>Most Common Regular Expressions Table</h2>\n<p>A regular expression, or regex, is a sequence of characters that is used to identify a pattern in text strings. To learn about regular expressions that are often used in YARA rules for PhishER, see the table below. For more information about regular expressions, see YARA's <a href='https://yara.readthedocs.io/en/latest/writingrules.html#regular-expressions' target='_blank' rel='noopener'>Writing YARA rules</a> documentation.</p>\n<table>\n<thead>\n<tr>\n<th scope='col'>Operators and Modifiers</th>\n<th scope='col'>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th scope='row'>\\n</th>\n<td>\n<p>This regex is an <a href='https://learn.microsoft.com/en-us/cpp/c-language/escape-sequences?view=msvc-170' target='_blank' rel='noopener'>escape sequence</a> that looks for a new line.\u00a0</p>\n</td>\n</tr>\n<tr>\n<th scope='row'>.</th>\n<td>This regex is a metacharacter that matches any character or symbol.</td>\n</tr>\n<tr>\n<th scope='row'>{n, m}</th>\n<td>\n<p>This regex is a quantifier that looks for a range of matches between a number of characters represented by <strong>n</strong> and <strong>m</strong>. This regex is used to identify matching segments of a string.</p>\n<div class='callout-note'>\n<div class='callout__content'>\n<strong>Note:</strong> You can use the <strong>{n,m}</strong> regex following any character. See the examples below:\n<ul role='list'>\n<li>9{2,3}: This regex will match 99 or 999.</li>\n<li>.{2,3}: This regex will match any two-character or three-character string.</li>\n</ul>\n</div>\n</div>\n</td>\n</tr>\n<tr>\n<th scope='row'>|</th>\n<td>This regex is a metacharacter that indicates an alternation operator, similar to an OR operator. This regex looks for a match among multiple possible regular expressions.</td>\n</tr>\n<tr>\n<th scope='row'>*</th>\n<td>This regex is a quantifier that looks for zero or more matches.</td>\n</tr>\n<tr>\n<th scope='row'>?</th>\n<td>This regex is a quantifier that looks for zero or one match.</td>\n</tr>\n</tbody>\n</table>\n<pre>const name = \"Chris Coyier\";\nconsole.log(name);\n</pre>",
    "user_segment_ids": [],
    "source_url": "https://support.knowbe4.com/hc/en-us/articles/360019622314-Use-Cases-for-YARA-Rules"
  }
}