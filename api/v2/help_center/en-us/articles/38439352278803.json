{
  "article": {
    "id": 38439352278803,
    "url": "https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/38439352278803.json",
    "html_url": "https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/38439352278803.html",
    "author_id": 20554076988819,
    "comments_disabled": true,
    "draft": false,
    "promoted": false,
    "position": 0,
    "vote_sum": 1,
    "vote_count": 3,
    "section_id": 20420703398419,
    "created_at": "2025-02-11T14:34:16Z",
    "updated_at": "2025-11-24T22:14:10Z",
    "name": "Update to Nested App Authentication Single Sign-On (NAA-SSO) for the Phish Alert Button (PAB)",
    "title": "Update to Nested App Authentication Single Sign-On (NAA-SSO) for the Phish Alert Button (PAB)",
    "source_locale": "en-us",
    "locale": "en-us",
    "outdated": false,
    "outdated_locales": [],
    "edited_at": "2025-11-24T22:14:10Z",
    "user_segment_id": null,
    "permission_group_id": 195648,
    "content_tag_ids": [],
    "label_names": [
      "localized",
      "answerbot",
      "Graph PAB",
      "MR PAB"
    ],
    "body": "<p>Microsoft has released Nested App Authentication, which allows for easier authentication and offers enhanced security and architectural flexibility compared to traditional full-trust and on-behalf-of authentication models. Because of this, Microsoft is deprecating legacy Exchange Online tokens starting on February 17, 2025. This means all <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/14701808484627.html'>Hybrid</a> and <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/26106205842707.html'>Microsoft Ribbon Phish Alert Buttons (PABs)</a> connected to Microsoft 365 domains will fail unless NAA-SSO is authorized. The <a href='https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/turn-exchange-tokens-on-off' target='_blank' rel='noopener noreferrer'>legacy Exchange Online tokens can be reenabled</a> until June 2025.</p>\n<p>Due to these changes, we recommend authorizing Graph APIs and NAA-SSO in your Phish Alert account settings. For more information, see <a href='https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/faq-nested-app-auth-outlook-legacy-tokens' target='_blank' rel='noopener noreferrer'>Microsoft\u2019s Nested app authentication and Outlook legacy tokens deprecation FAQ</a>.</p>\n<div class='callout-remember'>\n<div>\n<strong>Important:</strong>On February 25, 2025, we updated the fallback mechanism for the Microsoft Ribbon and Hybrid PABs. This updated manifest will allow the Microsoft Ribbon and Hybrid PABs to switch from NAA-SSO to SSO-OBO whenever it is in an environment that does not support NAA-SSO. You will need to update your XML manifest to implement the improved fallback mechanism.</div>\n</div>\n<div class='callout-note'>\n<div>\n<strong>Note:</strong>If you use the <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/7142051893011.html'>Microsoft Outlook (EXE Version) PAB</a>, these changes will not affect your PAB usage.</div>\n</div>\n<h2 id='h_01JKTNQEES5FG8XPM4SHEKK28E'>Prerequisites for NAA-SSO</h2>\n<ul>\n<li>Microsoft 365, which requires Global Administrator role to accept permissions.</li>\n<li>Exchange Online, which requires Global Administrator role to accept permissions.</li>\n<li>Monthly Enterprise Channel Version 2409 or newer. Older versions will cause the Microsoft Ribbon PAB to time out.</li>\n<li>Semi-Annual Channel Version 2408 or newer. Older versions will cause the Microsoft Ribbon PAB to time out.</li>\n<li>Current Channel Version 2410 or newer.</li>\n</ul>\n<div class='callout-note'>\n<div>\n<strong>Note: </strong>Safari and Firefox browsers may block the pop-up window when using the PAB in Outlook Web Access (OWA).</div>\n</div>\n<h3 id='h_01JPN443GGN7KS9E29RTT5PNQ7'>Additional Prerequisites</h3>\n<div class='callout-remember'>\n<div>\n<strong>Important:</strong>Starting October 14, 2025, <a href='https://learn.microsoft.com/en-us/lifecycle/products/outlook-2016' target='blank'>Outlook 2016</a>, <a href='https://learn.microsoft.com/en-us/lifecycle/products/outlook-2019' target='blank'>Outlook 2019</a>, <a href='https://learn.microsoft.com/en-us/lifecycle/products/exchange-server-2016' target='blank'>Exchange Server 2016</a>, and <a href='https://learn.microsoft.com/en-us/lifecycle/products/exchange-server-2019' target='blank'>Exchange Server 2019</a> will reach their lifecycle end dates with Microsoft and will no longer be supported.</div>\n</div>\n<p>NAA-SSO availability will vary depending on the version of Microsoft Office and Microsoft Outlook being used. To determine if your environment supports NAA-SSO, refer to Microsoft's <a href='https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/nested-app-auth-requirement-sets?view=common-js-preview' target='blank'>Nested app auth requirement set</a> article. Compatible versions include:</p>\n<ul>\n<li>Microsoft Outlook on Windows (volume-licensed perpetual) Version 2408 (Build 17932.20222) or later.</li>\n<li>Microsoft Outlook on Windows (retail perpetual) Version 2501 (Build 18429.20132) or later.</li>\n</ul>\n<p><strong>Important version notes:</strong></p>\n<ul>\n<li>Microsoft Office 2024 (volume-licensed perpetual) will support NAA-SSO.</li>\n<li>Microsoft Office 2021 (volume-licensed perpetual) will still support SSO-OBO for authentication but not NAA-SSO.</li>\n<li>Microsoft Office 2016 and 2019 (volume-licensed perpetual) will not support NAA-SSO or SSO-OBO authentication. For more information on Microsoft Office 2016 and 2019, see <a href='https://learn.microsoft.com/en-us/lifecycle/announcements/october-14-2025-products-end-of-support' target='_blank' rel='noopener'>Microsoft's documentation</a>.</li>\n<li>Microsoft Outlook on Windows (retail perpetual) Version 2008 (Build 13127.20000) or later will support SSO-OBO authentication.</li>\n</ul>\n<div class='callout-note'>\n<div>\n<strong>Note: </strong>Authenticating with SSO-OBO requires the Identity API v1.3. For more information see Microsoft's <a href='https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets?view=common-js-preview' target='_blank' rel='noopener noreferrer'>Identity API requirement sets</a> article.</div>\n</div>\n<div class='callout-remember'>\n<div>\n<strong>Remember:</strong>The error \"Your mail server needs a valid authentication token\" is caused by Microsoft deprecating legacy Exchange authentication tokens. To resolve this error, you must authorize Nested App Authentication - single sign-on (NAA-SSO).</div>\n</div>\n<h2 id='h_01JKTNQEESNS1KQE7P7WXK6VP9'>Accepting Permissions for NAA-SSO</h2>\n<p>To accept permissions for the NAA-SSO with Microsoft, follow the steps below.</p>\n<ol>\n<li>Log in to your KSAT account and click on your email address in the top-right corner of the page.</li>\n<li>Select <strong>Account Settings</strong>, then navigate to <strong>Account Integrations &gt; Phish Alert</strong>.</li>\n<li>Click the drop-down menu to expand your PAB settings.</li>\n<li>Scroll down and click <strong>Authorize NAA-SSO for GRAPH APIs</strong>. You\u2019ll be redirected to a Microsoft 365 login page.<br>\n<div class='callout-note'>\n<div>\n<strong>Note: </strong>You\u2019ll also need to click <strong>Accept Microsoft Permissions to Authorize GRAPH APIs for the PAB</strong> if those permissions haven\u2019t been previously accepted.</div>\n</div>\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/Authorize_Permissions.png'><img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/Authorize_Permissions.png' alt=' '></a></p>\n</li>\n<li>Log in to your Microsoft 365 account using your admin credentials.</li>\n<li>Once you log in, the <strong>Permissions requested</strong> pop-up window will display. Read the permissions, then click <strong>Accept</strong>.<br>\n<div class='callout-note'>\n<div>\n<strong>Note: </strong>If multiple PAB instances are deployed to different Microsoft 365 tenants, you must accept the permissions to Authorize Graph APIs and NAA-SSO for each PAB instance on each tenant.</div>\n</div>\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/Microsoft_Permissions.png'><img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/Microsoft_Permissions.png' alt=' '></a></p>\n</li>\n<li>Once you accept the permissions, the <strong>GRAPH Authorization Successful</strong> window will display. It can take up to 48 hours after accepting the permissions for NAA-SSO to apply to your user's Microsoft Outlook profiles.\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/Graph_Auth_Success.png'><img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/Graph_Auth_Success.png' alt=' '></a></p>\n</li>\n</ol>\n<h2 id='h_01K4ZTXJTSQ9ZC1JPD679BYJNK'>Internet Explorer NAA-SSO</h2>\n<p>If your organization uses Outlook on Microsoft Edge in Internet Explorer mode or Internet Explorer with Microsoft 365, you need to <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/38439352278803.html'>authorize permissions</a> for Graph APIs and NAA-SSO for the PAB before June 2025 to avoid service interruption. Once permissions are authorized, you can <a href='https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/turn-exchange-tokens-on-off' target='_blank' rel='noopener noreferrer'>disable legacy Exchange Online tokens</a> and report an email with the PAB to ensure it works correctly.</p>\n<div class='callout-remember'>\n<div>\n<strong>Important:</strong>To use this feature, your organization must use Microsoft 365. This feature isn\u2019t available for Exchange Online.</div>\n</div>\n<h3 id='h_01JT9DKGHNQV264CT08MVVQNMX'>User Experience</h3>\n<p>Below is the user experience for Internet Explorer NAA-SSO:</p>\n<ol>\n<li>Click the PAB in the ribbon.\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/IE+Outlook+Inbox.png'> <img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/IE+Outlook+Inbox.png' alt=''> </a></p>\n</li>\n<li>It will load in the task pane and show a pop-up window.</li>\n<li>Users will need to log in to their Microsoft account the first time reporting with the PAB.\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/IE+Outlook+Authentication.png'> <img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/IE+Outlook+Authentication.png' alt=''> </a></p>\n<div class='callout-note'>\n<div>\n<strong>Note:</strong>If users are unable to authenticate with NAA-SSO or SSO-OBO, the PAB will fall back to the interactive authentication mechanism that requires users to log in to Microsoft for the first time using the PAB.</div>\n</div>\n</li>\n<li>Click the <strong>Phish Alert</strong> button to report the email.\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/IE+Outlook+Permissions+Accepted.png'> <img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/IE+Outlook+Permissions+Accepted.png' alt=''> </a></p>\n</li>\n</ol>\n<h2 id='h_01JKTNQEESMC3KD73JDSNNJ24B'>Troubleshooting</h2>\n<div class='callout-note'>\n<div>\n<strong>Note: </strong>If the issue you are experiencing is not listed in the troubleshooting steps below, <a href='https://support.knowbe4.com/hc/en-us/requests/new'>contact support</a> for assistance.</div>\n</div>\n<p><strong>Question:</strong> Does this require me to redeploy the Phish Alert Button (PAB) XML manifest after authorizing NAA-SSO?</p>\n<p><strong>Answer:</strong> No, just accepting the permissions will be enough.</p>\n<p><strong>Question:</strong> I\u2019m receiving the following error: \"Your mail server needs a valid authentication token for the Phish Alert Button. If you need assistance with your mail server settings, please contact your admin.\" How can I resolve it?</p>\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/AuthToken_Error.png'><img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/AuthToken_Error.png' alt=' '></a></p>\n<p><strong>Answer:</strong> This indicates that the PAB you\u2019re using is trying to authenticate with the deprecated legacy Exchange Online token. Try the following steps to resolve the error:</p>\n<ol>\n<li>We recommend repeating steps 1-7 in the <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/38439352278803.html'>Accepting Permissions for NAA-SSO</a> section above. If this does not resolve this issue, try redeploying the PAB by following steps 2 through 5 below.</li>\n<li>\n<a href='https://learn.microsoft.com/en-us/microsoft-365/admin/manage/manage-addins-in-the-admin-center?view=o365-worldwide#delete-an-add-in' target='_blank' rel='noopener noreferrer'>Uninstall the current PAB in your Microsoft 365 admin center</a> by going to <strong>Settings &gt; Integrated Apps &gt; Add-ins.</strong>\n</li>\n<li>Find your PAB add-in in the list.</li>\n<li>Select the add-in and click <strong>Remove app</strong>.</li>\n<li>Reinstall the PAB manifest file. See our <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/208969608.html'>PAB installation guides</a> for more information.<br>\n<div class='callout-note'>\n<div>\n<strong>Note:</strong>If you use the Hybrid PAB, we recommend updating the PAB XML manifest before removing and redeploying it. For more information, see our documentation on <a href='https://Criscras13.github.io/KB_Transformer/api/v2/help_center/en-us/articles/14701808484627.html'>Updating and Uninstalling the Hybrid PAB</a>.</div>\n</div>\n</li>\n</ol>\n<p><strong>Question: </strong>I'm receiving the following error: \"We were unable to process this item. Please try again later.\" How can I resolve it?</p>\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/MRPAB_Timeout.png'><img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/MRPAB_Timeout.png' alt=' '></a></p>\n<p><strong>Answer:</strong> Toggling on New Outlook should resolve this issue.</p>\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/NewOutlook_Toggle.png'><img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/NewOutlook_Toggle.png' alt=' '></a></p>\n<p><strong>Question:</strong> What permission scopes does the Graph-enabled PAB use?</p>\n<p><strong>Answer:</strong> Here are the permission scopes used by the Graph-enabled PAB:</p>\n<ul>\n<li>\n<strong>Mail.Read:</strong> This permission allows the PAB to read the user's email and is used to get email headers, attachments and the content of the email body.</li>\n<li>\n<strong>Mail.Read.Shared:</strong> This permission allows the PAB to read the emails of shared mailbox users and is used to get email headers, attachments and the content of the email body.</li>\n<li>\n<strong>Mail.ReadWrite:</strong> This permission allows the PAB to read and write user emails.</li>\n<li>\n<strong>Mail.ReadWrite.Shared:</strong> This permission allows the PAB to read and write emails in shared mailboxes.</li>\n<li>\n<strong>Mail.Send:</strong> This permission allows the PAB to send user emails.</li>\n<li>\n<strong>Mail.Send.Shared:</strong> This permission allows the PAB to send emails from shared mailboxes, granted that the user has the send-as permission enabled for the shared mailbox.</li>\n<li>\n<strong>openid:</strong> This permission allows the PAB to get basic information about the user.</li>\n<li>\n<strong>profile:</strong> This permission allows the PAB to access the user\u2019s profile information.</li>\n</ul>\n<p><strong>Question:</strong> Do I need to authorize Nested App Authentication Single Sign On (NAA-SSO) or Single Sign On On-Behalf-Of (SSO-OBO) for each type of PAB I use?</p>\n<p><strong>Answer:</strong> NAA-SSO and SSO-OBO authorizations are on a per Microsoft 365 tenant basis. This means that if you have NAA-SSO enabled for Hybrid PAB on your tenant, you don\u2019t need to authorize it for the Microsoft Ribbon PAB or other types of PAB. This is the same for SSO-OBO.</p>\n<p><strong>Question:</strong> How do I check for the Microsoft Graph API permissions used by the PAB?</p>\n<p><strong>Answer:</strong> Using your Microsoft Entra portal, you can check the PAB's Microsoft Graph API permissions:</p>\n<ol>\n<li>Login to your Microsoft Entra admin center and navigate to <strong>Applications &gt; Enterprise Applications</strong>.</li>\n<li>Filter out the PAB by typing in \u2018phish alert\u2019 on the filter input box.</li>\n<li>Then click on the Phish Alert button entry and check the details related to the Phish Alert button.</li>\n</ol>\n<p><strong>Question:</strong> What should I do if I enabled NAA-SSO, but the Hybrid PAB didn\u2019t work for my environment?</p>\n<p><strong>Answer:</strong> Check if the PAB permissions were accepted for NAA-SSO and Graph APIs for the PAB. The permissions table will look similar to this:</p>\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/Azure_Permissions.png'><img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/Azure_Permissions.png' alt=' '></a></p>\n<p>If you\u2019ve confirmed that the permissions have been accepted and the issue still isn\u2019t resolved, contact our <a href='https://support.knowbe4.com/hc/en-us/requests/new'>support team</a>.</p>\n<p><strong>Question:</strong> How long do the permissions take to update once accepted?</p>\n<p><strong>Answer:</strong> Permissions are updated almost instantly for browsers and new Outlook clients. However, for Windows Outlook clients, it might take some time to update. If you\u2019re using a Windows Outlook client and your permissions are taking a while to update, we suggest <a href='https://learn.microsoft.com/en-us/office/dev/add-ins/testing/clear-cache' target='_blank' rel='noopener noreferrer'>deleting the WEF or cache folder of Windows Outlook</a>.</p>\n<p><strong>Question:</strong> Will our users notice any difference once we authorize NAA-SSO?</p>\n<p><strong>Answer:</strong> The only difference users will see is that it may say Graph in the top right corner after they click the PAB to report an email.</p>\n<p><a data-fancybox='single' data-src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/GraphPAB_NAASSO.png'><img src='https://helpimg.s3.us-east-1.amazonaws.com/PAB/MSR/EN/GraphPAB_NAASSO.png' alt=' '></a></p>",
    "user_segment_ids": [],
    "source_url": "https://support.knowbe4.com/hc/en-us/articles/38439352278803-Update-to-Nested-App-Authentication-Single-Sign-On-NAA-SSO-for-the-Phish-Alert-Button-PAB"
  }
}